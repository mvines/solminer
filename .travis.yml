language: node_js
node_js:
  - node

os:
- osx

dist: trusty
osx_image: xcode8.3
sudo: false

notifications:
  email: false

addons:
  apt:
    packages:
    - fakeroot
    - rpm

branches:
  only:
  - master
  - /^v\d+\.\d+\.\d+/

install:
- yarn

script:
- npm run lint
- set -x; export TRAVIS_TAG=1.2.3; if [ -z $TRAVIS_TAG ]; then
    if [ $TRAVIS_OS_NAME = linux ]; then
      npx semantic-release;
    fi;
    npm run make;
  else
    npm version $TRAVIS_TAG --no-git-tag-version;
    npm run publish;
  fi;
  du out
